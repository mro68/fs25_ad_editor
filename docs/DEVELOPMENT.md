# Development Notes

## Wichtige Erkenntnisse aus der Analyse

### Dart-Projekt (fs25_edit)
- âœ… Structure of Arrays (SoA) Parsing ist korrekt implementiert
- âœ… Delimiter-Logik (`,` und `;`) ist identisch mit Java
- âš ï¸ Flag-Bereinigung (AutoGenerated/SplineGenerated â†’ Regular) nicht implementiert
- âœ… Robusteres ID-Mapping via `HashMap` statt Array-Index

### Java-Projekt (AutoDrive_Course_Editor)
- âœ… Reference-Implementierung fÃ¼r Flag-Bereinigung
- âœ… Flag 2/4 â†’ 0 Bereinigung beim Laden
- âš ï¸ Erzwingt strikt fortlaufende IDs (weniger robust)
- âœ… Multi-threaded Rendering (fÃ¼r Rust nicht nÃ¶tig)

### Flutter-DDS-Package
- â„¹ï¸ Manuelle DXT1/3/5 Dekodierung vorhanden
- ğŸš« Nicht portieren â†’ Rust-Crates verwenden (dds-rs oder image)

### fs25_tools (Spatial Index)
- âœ… Grid + KD-Tree Hybrid als Konzept interessant
- ğŸš« Dart-spezifische Memory-Hacks nicht nÃ¶tig in Rust
- âœ… Verwende stattdessen `kiddo` Crate (optimierter KD-Tree)

## Entscheidungen fÃ¼r Rust-Port

### Datenmodell
```rust
// Verwende HashMap fÃ¼r Robustheit
struct RoadMap {
    nodes: HashMap<u64, MapNode>,
    connections: Vec<Connection>,
    version: u32,
}
```

### XML-Parsing
1. Parse mit `quick-xml` in SoA
2. Implementiere `parse_list` Helper (Delimiter-aware)
3. Wende Versions-Logik nach dem Parsing an

### Heightmap-Integration
- PNG-Heightmaps via `image` crate
- Bikubische Interpolation (16 Nachbarpixel) fÃ¼r prÃ¤zise Y-Werte
- Catmull-Rom Spline fÃ¼r glatte HÃ¶henÃ¼bergÃ¤nge
- Y-Berechnung nur beim Export (Editor bleibt 2D)
- Warnung beim Speichern ohne Heightmap
- Optionale Heightmap (Y=0 als Fallback)

### Rendering
- 2D-Ansicht (keine 3D-Transformation nÃ¶tig)
- Single-Thread ausreichend (wgpu ist async)
- GPU-Instancing fÃ¼r Performance
- Grow-only Buffer-Reuse in Node/Connection-Renderer (keine per-frame Neuallokation)
- CPU-Viewport-Culling vor GPU-Upload (Nodes + Connections)

## NÃ¤chste Schritte
1. âœ… Projekt-Setup
2. âœ… Core-Datenmodelle definiert
3. âœ… XML-Parser implementiert
4. âœ… Tests mit echten AutoDrive-Configs
5. âœ… `unwrap()`-Bereinigung in App-Use-Cases (Guard + frÃ¼he Returns)
6. âœ… `main.rs` in Runner/Adapter-orientierte Update-Schritte zerlegt
7. âœ… Gezielte UI-/Render-Tests ergÃ¤nzt (Inputâ†’Intent, Culling-Geometrie)

## Aktuelle Arbeitsweise
- Dokumentation wird derzeit manuell aktualisiert (kein automatischer Doku-Sync aktiv).
- CI-Aktivierung ist momentan nicht Teil des aktiven Umfangs.
