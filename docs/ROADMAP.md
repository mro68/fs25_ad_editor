# Roadmap

## Phase 1: Foundation ‚úÖ
- [x] Projekt-Setup
- [x] Core-Datenmodelle (`RoadMap`, `MapNode`, `Connection`)
- [x] XML-Parser (Import)
- [x] XML-Writer (Export)
  - [x] XML-Deklaration korrekt (encoding="utf-8", standalone="no")
  - [x] Koordinaten-Pr√§zision (3 Dezimalstellen)
  - [x] Optionen-Reihenfolge beibehalten
  - [x] Marker-Import/Export
  - [x] Heightmap-Integration (PNG-Loader)
  - [x] Bikubische Interpolation f√ºr Y-Koordinaten
- [x] Roundtrip-Tests (XML Import ‚Üí Export ‚Üí Diff)
- [x] Flag-Bereinigung (AutoGenerated/SplineGenerated ‚Üí Regular)
- [x] Integration-Tests mit echten AutoDrive-Configs

## Phase 2: 2D-Rendering ‚úÖ
- [x] wgpu Setup und Basic 2D-Rendering
- [x] Node Instancing (Punkte als Quads)
- [x] Connection Instancing (Linien mit Pfeilspitzen)
- [x] 2D-Kamera-System (Pan, Zoom)
- [x] Viewport-Culling (CPU-basiert im Renderpfad)
- [x] Map-Image-Rendering (DDS/PNG/JPG-Hintergrund)
- [x] Render-Quality-Presets im UI

## Phase 3: UI Basics ‚úÖ
- [x] egui Integration
- [x] Toolbar (Tool-Auswahl: Select, Connect, AddNode)
- [x] Status-Panel (Node-Count, Selection-Info)
- [x] File-Dialogs (Open)
- [x] File-Dialogs (Save mit Heightmap-Warnung)
- [x] File-Dialogs (Save As)
- [ ] Basic Theme/Icons
- [x] Keyboard-Shortcuts (Ctrl+O, Ctrl+S, Ctrl+Z, Ctrl+Y, Delete, Escape, etc.)
- [x] Options-Dialog (Farben, Gr√∂√üen, Breiten ‚Äì Live-Preview)
- [x] TOML-Persistierung (fs25_auto_drive_editor.toml neben Binary)

## Phase 4: Editor-Tools ‚úÖ (Kern abgeschlossen)
- [x] **KD-Tree Integration (kiddo)**
  - [x] Spatial Index in RoadMap integrieren
  - [x] Query-API: `nearest_node()`, `nodes_within_radius()`, `nodes_within_rect()`
  - [x] Auto-Update bei Node-Mutationen
  - [ ] Performance-Tests (100k+ Nodes)
- [x] **Select Tool (Click)**
  - [x] World-Koordinaten-Transformation (Screen ‚Üí World)
  - [x] Node-Picking via KD-Tree
  - [x] Selection-State in AppState
  - [x] Visuelle Hervorhebung (Shader/Farbe)
  - [x] AppIntent: `NodePickRequested`, additive/extend_path Selektion
- [x] **Move Tool (Drag & Drop)**
  - [x] Drag-Start/Drag-Move/Drag-End Events (Lifecycle: Begin/Move/End)
  - [x] Node-Position aktualisieren (Use-Case: `move_selected_nodes`)
  - [x] Spatial-Index-Update nach Move
- [x] Rectangle Select (Multi-Selection)
- [x] Lasso-Selection
- [x] Segment-Selektion (zwischen Kreuzungen)
- [x] Add Node Tool (Click zum Hinzuf√ºgen)
- [x] Delete Tool (selektierte Nodes l√∂schen)
- [x] Connect Tool (Regular, Dual, Reverse)
  - [x] Connection-Direction UI (Standard-Richtung w√§hlbar)
  - [x] Connection-Priorit√§t UI (Regular/SubPrio)
  - [x] Bulk-Operationen (alle Verbindungen zwischen Selektion √§ndern/invertieren/trennen)
- [x] **Undo/Redo-System**
  - [x] Snapshot-basiertes Undo/Redo (max. 200 Schritte)
  - [x] UI-Buttons + Shortcuts (Ctrl+Z / Ctrl+Y)
  - [x] CommandLog f√ºr Debug-Zwecke
- [x] Properties-Panel (Node-IDs, Positionen, Verbindungen anzeigen/editieren)
- [x] Context-Menu (Rechtsklick ‚Üí Verbindungsaktionen)

## Phase 5: Advanced Features
- [x] DDS-Import f√ºr Map-Hintergr√ºnde
  - [x] Texture-Loader implementieren (PNG, JPG, DDS)
  - [x] Background-Quad-Renderer
  - [x] Map-Auswahl UI (Datei-Dialog + Men√º)
  - [x] Opacity- und Sichtbarkeits-Steuerung
  - [ ] Zoom-abh√§ngige LOD
- [ ] Kurven-Werkzeuge (Bezier, Arc-Spline)
  - [ ] Bezier-Interpolation
  - [ ] Arc-Spline (FS25-spezifisch)
  - [ ] Auto-Generation von Intermediate-Nodes
  - [ ] Kurven-Preview
- [üü°] Marker-Management
  - [x] Marker-Icons im Viewport (GPU-Instanced Pin-Symbole)
  - [x] Marker erstellen/l√∂schen (Use-Case + Kontextmen√º)
  - [x] Marker-Editor UI (Name, Gruppe bearbeiten)
  - [ ] Marker-Groups
- [ ] Grid-Overlay & Snap-to-Grid
- [ ] Minimap-Ansicht

## Phase 6: Performance & Qualit√§t
- [ ] Performance-Optimierung
  - [x] `within_rect` auf KD-Tree Range-Query umstellen (aktuell O(n) Brute-Force)
  - [x] **Connection-Lookup O(1):** `connections: Vec<Connection>` ‚Üí `HashMap<(u64,u64), Connection>`
  - [x] **COW-Undo via `Arc<RoadMap>`:** Snapshot ist O(1) statt O(n) Deep-Clone (Copy-on-Write)
  - [ ] LOD-System f√ºr gro√üe Strecken
  - [ ] Memory-Profiling
  - [x] `ctx.request_repaint()` nur bei √Ñnderungen (CPU-Idle-Verbrauch reduzieren)
- [ ] Error-Handling & User-Feedback
  - [ ] Toast-Notifications
  - [ ] Loading-Spinner
  - [ ] Error-Recovery
  - [ ] Input-Validierung
- [ ] Testing
  - [x] Roundtrip-Tests vollst√§ndig (Basis)
  - [ ] UI-Integration-Tests
  - [x] Performance-Benchmarks (Basis mit Criterion)
  - [ ] Performance-Benchmarks mit 100k+ Nodes
- [ ] Dokumentation
  - [ ] User-Guide
  - [x] API-Dokumentation pro Modul (API.md inkl. shared)
  - [ ] Keyboard-Shortcuts-√úbersicht
  - [x] Architektur-Analyse und API.md-Nachf√ºhrung (2026-02-20)
- [ ] Packaging
  - [ ] Windows Binaries (.exe)
  - [ ] Linux Binaries (AppImage)
  - [ ] CI/CD Pipeline (GitHub Actions)

## Phase 7: Optional / Future
- [ ] Web-Version (WASM)
  - [ ] wgpu WebGL/WebGPU Backend
  - [ ] Browser-File-Access
  - [ ] GitHub Pages Deployment
- [ ] Android-Support (optional)
- [ ] Online-Map-Image-Lookup
  - [ ] Giants Map-Repository Integration
  - [ ] Automatischer Download
- [ ] Auto-Save
  - [ ] Periodisches Speichern
  - [ ] Recovery nach Crash
- [ ] Plugin-System
  - [ ] Lua/WASM Scripting
  - [ ] Custom Tools API
- [ ] Collaborative Editing
  - [ ] Multi-User via WebSocket
  - [ ] Conflict Resolution
- [ ] Import/Export andere Formate
  - [ ] FS22 Legacy Support
  - [ ] CSV/JSON Export
  - [ ] GPS-Track Import

---

## üéØ MVP-Checkliste (Minimale nutzbare Version)

**Muss haben f√ºr MVP:**
- [x] XML Import/Export
- [x] Roundtrip-Tests bestehen
- [x] Viewport mit Pan/Zoom
- [x] KD-Tree Spatial Index
- [x] Select Tool (Click, Rect, Lasso, Segment)
- [x] Move Tool (Drag)
- [x] Save-Dialog (mit Heightmap-Warnung)
- [x] Undo/Redo
- [x] Save As Dialog

**Status: MVP zu ~100% erreicht.**

---

## üìä Aktueller Status (Stand: 2026-02-20)

**Fertigstellung:**
- Phase 1: ‚úÖ 100%
- Phase 2: ‚úÖ 100%
- Phase 3: ‚úÖ 98% (Theme fehlt)
- Phase 4: ‚úÖ 100% (alle Features implementiert, 100k-Benchmarks ausstehend)
- Phase 5: üü° 60% (DDS-Background + Marker-Editor fertig, Kurven-Werkzeuge ausstehend)
- Phase 6: üü° 25% (within_rect + Repaint optimiert, API-Docs nachgef√ºhrt, Architektur bereinigt)

**Errungenschaften seit letztem Update (Refactoring-Session):**
- ‚úÖ `connections` in `RoadMap`: `Vec<Connection>` ‚Üí `HashMap<(u64,u64), Connection>` ‚Äî alle lookup-Operationen O(1)
- ‚úÖ COW-Undo: `Snapshot` nutzt `Arc<RoadMap>` statt Deep-Clone ‚Äî O(1) statt O(n) pro Undo-Schritt
- ‚úÖ Shader-Deduplication: `shaders.wgsl` wird einmal in `Renderer::new()` geladen, an alle 4 Sub-Renderer weitergegeben
- ‚úÖ `center_on_road_map` aus `file_io.rs` in `use_cases/camera.rs` extrahiert (Separation of Concerns)
- ‚úÖ `background_dirty: bool` in `ViewState` ersetzt fragiles Arc-Pointer-Tracking in `main.rs`
- ‚úÖ `MarkerDialogConfirmed`: `is_new: bool` in Intent kodiert ‚Äî Controller-Mapping ohne State-Abh√§ngigkeit
- ‚úÖ `connections_iter()` + `invert_connection()` als neue √∂ffentliche RoadMap-API hinzugef√ºgt
- ‚úÖ Alle 29 Tests gr√ºn nach dem Refactoring

**Errungenschaften (Vorherige Session):**
- ‚úÖ Architektur-Verletzung behoben: `ui/dialogs.rs` importiert `RoadMap` via `app` statt direkt aus `core`
- ‚úÖ `core`-Modul von `shared`-Abh√§ngigkeit entkoppelt: Kamera-Konstanten direkt in `Camera2D`, `pick_radius_world()` nimmt `pick_radius_px`-Parameter
- ‚úÖ Alle 6 API.md-Dateien auf aktuellen Code-Stand nachgef√ºhrt
- ‚úÖ Marker-Editor UI (Name + Gruppe) als erledigt markiert
- ‚úÖ DDS-Background-Map vollst√§ndig (Phase 2 + Phase 5 korrigiert)
- ‚úÖ Options-Dialog implementiert (Farben, Gr√∂√üen, Breiten ‚Äì Live-Preview)
- ‚úÖ TOML-Persistierung: `fs25_auto_drive_editor.toml` neben Binary, automatisches Laden/Speichern
- ‚úÖ Alle Render-Konstanten von Kompilierzeit auf Laufzeit-Optionen umgestellt
- ‚úÖ `render/types.rs` bereinigt: obsolete Konstanten-Duplikate entfernt
- ‚úÖ `unwrap()` in `src/app/use_cases/**` eliminiert (fr√ºhe Returns + Guard-Checks)
- ‚úÖ `main.rs` in Runner/Adapter-Schritte aufgeteilt (`AppRunner`, Event-/Render-Adapter-Methoden)
- ‚úÖ Gezielte Tests erg√§nzt:
  - UI Input‚ÜíIntent: Keyboard-Shortcut-Mapping (`src/ui/keyboard.rs` Unit-Tests)
  - Render Culling-Basis: Geometrie-/Schnittlogik (`src/render/connection_renderer.rs` Unit-Tests)

**Hinweis zu Doku/Automatisierung:**
- ‚ÑπÔ∏è Dokumentation wird aktuell manuell gepflegt (kein Auto-Sync-Mechanismus aktiv)
- ‚ÑπÔ∏è CI ist derzeit nicht Teil des aktiven Arbeitsumfangs

**N√§chste Aufgaben:**
1. üü° 100k+ Performance-Benchmarks
2. üü¢ Undo/Redo auf Delta-basiert umstellen (Skalierung f√ºr 100k+ Nodes)
3. üü¢ LOD-System f√ºr gro√üe Strecken
4. üü¢ Theme/Icons
5. üü¢ Marker-Groups
6. üü¢ Toast-Notifications f√ºr User-Feedback
